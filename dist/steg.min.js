/*! steg.js - v0.1.1 - 2013-12-23
* Copyright (c) 2013 Kevin Selwyn; Licensed GPLv3 */
!function(a,b){"use strict";var c={vars:{header:"!steg.js!"},dec2bin:function(a){var b=parseInt(a,10).toString(2),c=0,d=8-b.length;for(c=0;d>c;c+=1)b="0"+b;return b},bin2dec:function(a){var b=parseInt(a,2).toString(10);return b=parseInt(b,10)},bin2ascii:function(a){var b=8*Math.floor(a.length/8),c="",d=0;for(d=0;b>d;d+=8)c+=String.fromCharCode(this.bin2dec(a.substr(d,8)));return c},canvas:function(b,c){var d=a.createElement("canvas"),e=d.getContext("2d"),f=a.createElement("img");f.onload=function(){d.width=this.width,d.height=this.height,e.drawImage(this,0,0),c(d)},f.src=b},pixelate:function(a,b,c){var d=a.getContext("2d"),e={},f=[],g=a.width,h=a.height,i=0,j=0,k=0,l=Math.ceil(b.length*(8/3));for(j=0;h>j;j+=1){for(i=0;g>i&&(e=d.getImageData(i,j,1,1).data,f.push(e),k+=1,!(k>=l));i+=1);if(k>=l)break}c(f,b)},hide:function(a,b,c){var d="",e=0,f=[],g=0,h=0,i=0,j=0,k=0;for(g=0,h=b.length;h>g;g+=1)d+=this.dec2bin(b.charCodeAt(g));for(g=0,h=a.length;h>g;g+=1)for(i=0,j=3;j>i;i+=1)e=this.dec2bin(a[g][i]),e=e.replace(/[01]$/,d.substring(k,k+1)),f.push(e),k+=1,k>=d.length&&(g=h,i=j);for(k=0,g=0,h=a.length;h>g;g+=1)for(i=0,j=3;j>i;i+=1)a[g][i]=this.bin2dec(f[k]),k+=1;c(a)},output:function(a,b,c){var d=b.getContext("2d"),e=d.createImageData(1,1),f=b.width,g=b.height,h=0,i=0,j=0,k=0,l=0;for(l=0;g>l;l+=1){for(k=0;f>k;k+=1){for(i=0,j=3;j>i;i+=1)e.data[i]=a[h][i];if(e.data[3]=255,d.putImageData(e,k,l),h+=1,h>=a.length)break}if(h>=a.length)break}c(b.toDataURL())},encode:function(a,b,c){var d=this,e=this.vars.header,f="",g="";f+=String.fromCharCode(255&b.length>>16),f+=String.fromCharCode(255&b.length>>8),f+=String.fromCharCode(255&b.length),g+=String.fromCharCode(0),g+=String.fromCharCode(0),g+=String.fromCharCode(0),b=e+f+g+b,this.canvas(a,function(a){d.pixelate(a,b,function(b,e){d.hide(b,e,function(b){d.output(b,a,function(a){c(a)})})})})},evaluate:function(a,b){var c=a.getContext("2d"),d=this.vars.header,e="",f=[],g="",h=0,i=a.width,j=a.height,k=0,l="",m="",n=0,o="",p=0,q=0,r=0,s=0,t=0,u=0;for(r=0,u=d.length;u>r;r+=1)e+=this.dec2bin(d.charCodeAt(r));for(r=0,u=d.length*(8/3),q=0;j>q;q+=1){for(p=0;i>p&&(f.push(c.getImageData(p,q,1,1).data),r+=1,!(r>=u));p+=1);if(r>=u)break}for(r=0,s=f.length;s>r;r+=1)for(t=0,u=3;u>t;t+=1)h=f[r][t],g+=this.dec2bin(h).substring(7,8);if(e!==g)return console.error("No steganography here"),void 0;for(f=[],r=0,u=8,p+=1,q;j>q;q+=1){for(p;i>p&&(f.push(c.getImageData(p,q,1,1).data),r+=1,!(r>=u));p+=1);if(r>=u)break}for(r=0,s=f.length;s>r;r+=1)for(t=0,u=3;u>t;t+=1)h=f[r][t],l+=this.dec2bin(h).substring(7,8);for(k=this.bin2dec(l),p+=8,f=[],r=0,u=k*(8/3),p+=1,q;j>q;q+=1){for(p;i>p&&(f.push(c.getImageData(p,q,1,1).data),r+=1,!(r>=u));p+=1);if(r>=u)break;p=0}for(r=0,s=f.length;s>r;r+=1)for(t=0,u=3;u>t;t+=1)h=f[r][t],m+=this.dec2bin(h).substring(7,8);n=m.length,m=m.substring(0,8*Math.floor(n/8)),o=this.bin2ascii(m),b(o)},decode:function(a,b){var c=this;this.canvas(a,function(a){c.evaluate(a,function(a){b(a)})})}};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=c:(b.steg=c,"function"==typeof define&&define.amd&&define("steg",[],function(){return c}))}(document,window);